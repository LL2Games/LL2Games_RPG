ì¢‹ì€ ê³ ë¯¼ì´ì•¼. ì´ê±° **ê²Œì„ ì„œë²„ IPC ì„¤ê³„ì—ì„œ ë‹¤ë“¤ í•œ ë²ˆì€ ë¶€ë”ªíˆëŠ” í¬ì¸íŠ¸**ì•¼ ğŸ‘
ê²°ë¡ ë¶€í„° ë§í•˜ë©´:

> **System V ë©”ì‹œì§€ íì—ì„œ _sendí•œ ìª½ì´ recvë„ ê°€ëŠ¥_í•˜ë‹¤.**
> ë‹¨, **â€œê°™ì€ í + ë‹¤ë¥¸ mtypeâ€ìœ¼ë¡œ ìš”ì²­/ì‘ë‹µì„ ë¶„ë¦¬**í•´ì•¼ í•œë‹¤.

ê·¸ë¦¬ê³  ë©”ì´í”Œ `/ì°¾ê¸°` ê°™ì€ ì¼€ì´ìŠ¤ëŠ” **â€œìš”ì²­ â†’ ì²˜ë¦¬ â†’ ì‘ë‹µâ€ íŒ¨í„´**ì´ê¸° ë•Œë¬¸ì—
**ë‹¨ë°©í–¥ í 1ê°œ**ë¡œë„ ê°€ëŠ¥í•˜ì§€ë§Œ, **ëª…í™•í•˜ê²Œ í•˜ë ¤ë©´ 2ê°€ì§€ ì„¤ê³„**ê°€ ìˆë‹¤.

---

## í•µì‹¬ ì§ˆë¬¸ ì •ë¦¬

### â“ chatD â†’ channelDë¡œ ì»¤ë§¨ë“œ ë³´ëƒ„

### â“ ê·¸ëŸ°ë° ê²°ê³¼ë¥¼ ë‹¤ì‹œ chatDê°€ ë°›ì•„ì•¼ í•¨

### â“ ë©”ì‹œì§€ íì—ì„œ ê·¸ê²Œ ê°€ëŠ¥í•¨?

ğŸ‘‰ **ê°€ëŠ¥í•¨ (ì•„ì£¼ ì •ì„ì ì¸ ì‚¬ìš©ë²•)**
ğŸ‘‰ ë‹¨, **mtypeì„ ì—­í• ë³„ë¡œ ë‚˜ëˆ ì•¼ í•¨**

---

## ğŸ”‘ ë©”ì‹œì§€ íì˜ ì¤‘ìš”í•œ ê°œë…

```c
msgrcv(msqid, &msg, size, mtype, 0);
```

ì—¬ê¸°ì„œ `mtype`ì€:

* **ëˆ„ê°€ ë³´ëƒˆëŠ”ì§€ê°€ ì•„ë‹ˆë¼**
* **ì–´ë–¤ íƒ€ì…ì˜ ë©”ì‹œì§€ë¥¼ ë°›ì„ì§€**ë¥¼ ì˜ë¯¸í•¨

ì¦‰,

* chatDë„ `msgsnd`
* chatDë„ `msgrcv`
* channelDë„ `msgsnd`
* channelDë„ `msgrcv`

ğŸ‘‰ **ë©”ì‹œì§€ íëŠ” â€œìš°ì²´í†µâ€ì´ê³  ì†¡ìˆ˜ì‹  êµ¬ë¶„ ì—†ìŒ**

---

## ğŸ® ê²Œì„ ì„œë²„ ê´€ì ì—ì„œì˜ êµ¬ì¡° (ì¶”ì²œ)

### ë©”ì‹œì§€ íƒ€ì… ì„¤ê³„

```c
#define MSG_CMD_REQUEST   1   // chatD -> channelD
#define MSG_CMD_RESPONSE  2   // channelD -> chatD
```

---

## ğŸ“Œ êµ¬ì¡° ìš”ì•½ (ë©”ì´í”Œ /ì°¾ê¸° ì˜ˆì‹œ)

```
[Client]
   |
   | "/ì°¾ê¸° íƒ€ë½íŒŒì›Œì „ì‚¬"
   v
[chatD]
   |  MSG_CMD_REQUEST
   v
[channelD]
   |  ì²˜ë¦¬ ê²°ê³¼ ìƒì„±
   v
[chatD]
   |  ì±„íŒ… / ëª¨ë‹¬ë¡œ ê²°ê³¼ í‘œì‹œ
   v
[Client]
```

---

# 1ï¸âƒ£ server (channelD ì—­í• )

ğŸ‘‰ **ìš”ì²­ì„ ë°›ê³ , ê²°ê³¼ë¥¼ ë‹¤ì‹œ ë©”ì‹œì§€ íë¡œ ì‘ë‹µ**

```c
// server.c (channelD)
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/ipc.h>
#include <sys/msg.h>

#define MSGKEY 1234
#define MSG_CMD_REQUEST  1
#define MSG_CMD_RESPONSE 2

struct msgbuf_
{
    long mtype;
    char mtext[1024];
};

int main()
{
    int msqid;
    struct msgbuf_ msg;

    msqid = msgget(MSGKEY, IPC_CREAT | 0666);
    if (msqid < 0)
    {
        perror("msgget");
        exit(1);
    }

    while (1)
    {
        // chatD -> channelD ìš”ì²­ ëŒ€ê¸°
        msgrcv(msqid, &msg, sizeof(msg.mtext), MSG_CMD_REQUEST, 0);
        printf("[channelD] ë°›ì€ ëª…ë ¹: %s\n", msg.mtext);

        // ëª…ë ¹ ì²˜ë¦¬ (ì˜ˆì‹œ)
        struct msgbuf_ resp;
        resp.mtype = MSG_CMD_RESPONSE;

        if (strcmp(msg.mtext, "/ì°¾ê¸° íƒ€ë½íŒŒì›Œì „ì‚¬") == 0)
        {
            strcpy(resp.mtext, "íƒ€ë½íŒŒì›Œì „ì‚¬ë‹˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
        else
        {
            strcpy(resp.mtext, "ì•Œ ìˆ˜ ì—†ëŠ” ëª…ë ¹ì…ë‹ˆë‹¤.");
        }

        // chatDë¡œ ì‘ë‹µ
        msgsnd(msqid, &resp, sizeof(resp.mtext), 0);
    }

    return 0;
}
```

---

# 2ï¸âƒ£ client (chatD ì—­í• )

ğŸ‘‰ **ëª…ë ¹ ë³´ë‚´ê³  + ì‘ë‹µë„ ë°›ìŒ**

```c
// client.c (chatD)
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/ipc.h>
#include <sys/msg.h>

#define MSGKEY 1234
#define MSG_CMD_REQUEST  1
#define MSG_CMD_RESPONSE 2

struct msgbuf_
{
    long mtype;
    char mtext[1024];
};

int main()
{
    int msqid;
    struct msgbuf_ msg, resp;

    msqid = msgget(MSGKEY, IPC_CREAT | 0666);
    if (msqid < 0)
    {
        perror("msgget");
        exit(1);
    }

    while (1)
    {
        printf("input: ");
        fgets(msg.mtext, sizeof(msg.mtext), stdin);
        msg.mtext[strcspn(msg.mtext, "\n")] = 0;

        // channelDë¡œ ëª…ë ¹ ì „ì†¡
        msg.mtype = MSG_CMD_REQUEST;
        msgsnd(msqid, &msg, sizeof(msg.mtext), 0);

        // channelDì˜ ì²˜ë¦¬ ê²°ê³¼ ìˆ˜ì‹ 
        msgrcv(msqid, &resp, sizeof(resp.mtext), MSG_CMD_RESPONSE, 0);
        printf("[chatD] ê²°ê³¼: %s\n", resp.mtext);
    }

    return 0;
}
```

---

## ğŸ”¥ ì—¬ê¸°ì„œ ì¤‘ìš”í•œ í¬ì¸íŠ¸

### âœ… sendí•œ í”„ë¡œì„¸ìŠ¤ê°€ recv ê°€ëŠ¥?

âœ” **ê°€ëŠ¥**
âœ” **ì•„ì£¼ ì •ìƒì ì¸ êµ¬ì¡°**

---

## âš ï¸ í•˜ì§€ë§Œ ì‹¤ì œ ê²Œì„ ì„œë²„ì—ì„  ë³´í†µ ì´ë ‡ê²Œ ë°œì „í•¨

### ë¬¸ì œì  (ë©”ì‹œì§€ í ë‹¨ë… ì‚¬ìš© ì‹œ)

* blocking `msgrcv` â†’ chatD ë©ˆì¶œ ìˆ˜ ìˆìŒ
* ì—¬ëŸ¬ ìœ ì € ìš”ì²­ ì„ì´ë©´ **ì‘ë‹µ ë§¤ì¹­ ì–´ë ¤ì›€**
* scale-out ë¶ˆë¦¬

---

## ğŸš€ ì‹¤ì „ ì¶”ì²œ êµ¬ì¡° (LL2Games ìŠ¤íƒ€ì¼)

### 1ï¸âƒ£ ë©”ì‹œì§€ í + request_id

```c
struct CommandMsg {
    long mtype;
    int  request_id;
    int  user_id;
    char cmd[256];
};
```

â†’ ì‘ë‹µì— `request_id` ê·¸ëŒ€ë¡œ ëŒë ¤ì¤Œ

---

### 2ï¸âƒ£ IPC ì—­í•  ë¶„ë¦¬ (ë” ê¶Œì¥)

| ìš©ë„                  | IPC                    |
| ------------------- | ---------------------- |
| chatD â†’ channelD ëª…ë ¹ | **Message Queue**      |
| channelD â†’ chatD ê²°ê³¼ | **Unix Domain Socket** |
| ì‹¤ì‹œê°„ ì±„íŒ…              | UDS / TCP              |

ğŸ‘‰ **ëª…ë ¹ì€ í / ê²°ê³¼ëŠ” ì†Œì¼“**
ğŸ‘‰ MMORPG ì„œë²„ì—ì„œ ë§ì´ ì“°ëŠ” íŒ¨í„´

---

## ğŸ¯ ê²°ë¡ 

* âœ” ë©”ì‹œì§€ íì—ì„œ **sendí•œ ìª½ì´ recv ê°€ëŠ¥**
* âœ” **mtypeìœ¼ë¡œ ìš”ì²­/ì‘ë‹µ ë¶„ë¦¬**í•˜ë©´ ë¬¸ì œ ì—†ìŒ
* âœ” ë©”ì´í”Œ `/ì°¾ê¸°` ê°™ì€ ì¼€ì´ìŠ¤ëŠ” **ë°˜ë“œì‹œ ì‘ë‹µ êµ¬ì¡° í•„ìš”**
* âš  ê·œëª¨ ì»¤ì§€ë©´ **í ë‹¨ë… ì‚¬ìš©ì€ í•œê³„**
* ğŸš€ ì‹¤ì „ì€ **MQ + UDS í˜¼í•© êµ¬ì¡°** ì¶”ì²œ

---

ë‹¤ìŒìœ¼ë¡œ ì›í•˜ë©´ ğŸ‘‡
ğŸ‘‰ **request_id í¬í•¨í•œ ì‹¤ì „ êµ¬ì¡°**
ğŸ‘‰ **chatD ë¹„ë™ê¸° recv êµ¬ì¡° (non-blocking)**
ğŸ‘‰ **í vs UDS vs shared memory ë¹„êµ**

ì–´ë””ê¹Œì§€ ê°ˆì§€ ì •í•´ì¤˜ ğŸ˜„
